import pandas as pd
from googletrans import Translator
import os

# 初始化翻译器
translator = Translator()

# 指定目标文件夹路径
folder_path = "/content/drive/MyDrive/YUE lab data/信義區"

# 遍历文件夹中的 CSV 文件
for file_name in os.listdir(folder_path):
    if file_name.endswith(".csv"):  # 检查是否是 CSV 文件
        file_path = os.path.join(folder_path, file_name)  # 获取完整路径
        print(f"正在处理文件：{file_name}")
        
        # 读取 CSV 文件
        df = pd.read_csv(file_path)
        
        # 检查是否存在 "評論" 列
        if "評論" not in df.columns:
            print(f"文件 {file_name} 中没有 '評論' 列，跳过。")
            continue
        
        # 翻译每条评论
        translations = []
        for text in df["評論"]:
            try:
                # 翻译评论
                translation = translator.translate(str(text), dest="en")
                translations.append(translation.text)
            except Exception as e:
                # 翻译失败，保留原文本
                print(f"翻译失败：{text}，错误信息：{e}")
                translations.append(text)
        
        # 创建新的 DataFrame
        new_df = pd.DataFrame({
            "Original": df["評論"],
            "EN": translations
        })
        
        # 保存翻译结果为新文件
        output_file_name = os.path.splitext(file_name)[0] + "_translated.csv"
        output_file_path = os.path.join(folder_path, output_file_name)
        new_df.to_csv(output_file_path, index=False)
        print(f"已保存翻译文件：{output_file_path}")
